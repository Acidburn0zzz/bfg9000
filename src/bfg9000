#!/usr/bin/env python
# -*- python -*-

import argparse
import importlib
import os.path
import sys

import builtins
import builtin_rules
import node
import utils
from environment import Environment

bfgfile = 'build.bfg'

parser = argparse.ArgumentParser()
parser.add_argument('builddir', help='build directory')
parser.add_argument('--backend', help='backend', default='make')
args = parser.parse_args()

backend = importlib.import_module('backends.{}'.format(args.backend))
env = Environment(srcdir=os.getcwd(), builddir=os.path.abspath(args.builddir))

inputs = node.BuildInputs()
execfile(bfgfile, builtins.bind(inputs))
backend.write(env, inputs)
